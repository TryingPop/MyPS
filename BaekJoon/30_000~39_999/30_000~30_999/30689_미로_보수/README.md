# C#

## 난이도 : 골드 3

## 알고리즘 분류
  - 그래프 이론
  - 그래프 탐색
  - 깊이 우선 탐색
  - 함수형 그래프

## 제한조건
  - 시간 제한 : 2초
  - 메모리 제한 : 1024 MB

## 문제
각 칸에 '상', '하', '좌', '우' 중 하나가 표시되어 있고 세로로 N칸, 가로로 M칸인 N x M 크기의 미로가 있다. 해당 칸으로 도착한 모든 사람은 미로에 표시된 방향으로 한 칸 이동한다. 이를 반복해 미로 밖으로 벗어나면 미로에서 탈출할 수 있다.<br/>

|←|←|←||${\textsf{\color{blue}<}}$|${\textsf{\color{blue}←}}$|${\textsf{\color{blue}←}}$||←|←|←|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|↓|←|↑||↓|←|${\textsf{\color{blue}↑}}$||${\textsf{\color{magenta}↓}}$|${\textsf{\color{magenta}←}}$|↑|
|→|↑|↑||→|↑|${\textsf{\color{blue}↑}}$||${\textsf{\color{magenta}→}}$|${\textsf{\color{magenta}↑}}$|↑|



해당 그림의 파란색 경로는 미로에서 탈출하는 예시이다. 하지만 운이 나쁘다면 그림의 빨간색 경로와 같이 영원히 미로에서 탈출하지 못할 수도 있다! 영원히 탈출하지 못하는 상황을 막기 위해, 형진이는 미로를 보수하기로 했다.<br/>


|←|←|←|
|:---:|:---:|:---:|
|◈|←|↑|
|→|↑|↑|


형진이는 미로에 원하는 만큼 점프대를 설치할 수 있다. 점프대를 설치하면 해당 위치에 도착한 사람들은 점프를 통해 바로 미로 밖으로 빠져나올 수 있다.<br/>
점프대를 설치하기 위해서는 해당 칸의 지리적 조건 등을 고려해야 하므로, 어느 칸에 설치하냐에 따라 점프대의 비용이 달라진다. 정확하게는 i행 j열의 칸에 점프대를 설치하는 것은 Cost_{i,j} 만큼의 비용이 필요하다.<br/>
주어진 미로에서 최소한의 비용을 사용해 점프대를 설치해, 미로의 어느 칸에서 시작하더라도 탈출할 수 있도록 만들고 싶다. 필요한 최소한의 비용을 구해보자.<br/>


## 입력
입력은 다음과 같이 주어진다.<br/>

	N M 
	B_{1,1} B_{1,2} ... B_{1,M}
	B_{2,1} B_{2,2} ... B_{2,M} 
	... 
	B_{N,1} B_{N,2} ... B_{N,M} 
	Cost_{1,1} Cost_{1,2} ... Cost_{1,M} 
	Cost_{2,1} Cost_{2,2} ... Cost_{2,M}
	...
	Cost_{N,1} Cost_{N,2} ... Cost_{N,M} 


첫째 줄에 미로의 행의 수 N, 열의 수 M이 공백을 사이에 두고 주어진다.<br/>
이어 N개의 줄에 걸쳐 미로판 B를 표현한 길이가 M인 문자열이 주어진다. 문자열은 대문자 알파벳 U, D, L, R만으로 이루어져 있다. 각각의 알파벳은 '상', '하', '좌', '우'를 뜻한다.<br/>
이어 N개의 줄에 걸쳐 미로의 각 칸에서 점프대를 설치하는 비용 정보 Cost가 공백을 사이에 두고 주어진다.<br/>


## 출력
미로의 어느 칸에서 시작하더라도 탈출할 수 있도록 하는 최소 비용을 출력한다.<br/>


## 제한
  - 1 ≤ N, M ≤ 2,000
  - 1 ≤ Cost_{i,j} ≤ 500


## 예제 입력
3 3<br/>
LLL<br/>
DLU<br/>
RUU<br/>
3 1 5<br/>
2 9 6<br/>
8 7 1<br/>


## 예제 출력
2<br/>


## 풀이
이동 방향을 단방향 간선으로 표현하면, 주어진 표는 그래프로 볼 수 있습니다.<br/>
탈출하지 못하는 경우는 사이클에 진입하는 경우이며, 따라서 각 사이클마다 가장 설치 비용이 적은 지점에 점프대를 설치하는 것이 최적입니다.<br/>


사이클 판별은 DFS를 사용했습니다.<br/>
각 탐색마다 현재 탐색 번호를 idx로 두고, 이동 가능한 방향을 따라가며 방문 여부를 확인합니다.<br/>
만약 이미 idx를 방문한 적이 있다면, 이는 사이클에 진입한 것으로 판단할 수 있습니다.<br/>


DFS 탐색 중 방문 상태를 -1로 표시하며 진행하고, -1을 다시 만날 때까지 경로를 추적합니다.<br/>
이 경로가 하나의 사이클이 되며, 그 중 가장 설치 비용이 적은 위치를 선택합니다.<br/>


또한, 이미 처리된 지점이거나 idx보다 낮은 번호의 지점을 만난 경우는 앞에서 처리된 사이클이거나 외부로 빠져나가는 경로이므로 무시하고 탈출할 수 있습니다.<br/>


이렇게 모든 사이클에 대해 설치 비용을 계산해 정답을 구했습니다.<br/>


참고로, 사이클 판별용 DFS를 따로 구현하지 않고, 방문 기록과 스택을 활용하는 방식으로도 구현할 수 있습니다.<br/>
스택을 이용하면, 사이클을 구성하는 노드는 방문 스택 내에서 현재 노드부터 동일한 노드를 다시 만날 때까지의 구간으로 쉽게 추출할 수 있습니다.<br/>


## 문제 링크
https://www.acmicpc.net/problem/30689