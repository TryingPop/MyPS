# C#

## 난이도 : 골드 3

## 알고리즘 분류
  - 다이나믹 프로그래밍
  - 중간에서 만나기

## 제한조건
  - 시간 제한 : 1초
  - 메모리 제한 : 128 MB

## 문제
정수 N개로 이루어진 수열 A가 있다. 이때, i번째 수가 그 앞에 있는 수 세 개의 합으로 나타낼 수 있을 때, 그 수를 좋다고 한다. (같은 위치에 있는 수를 여러 번 더해도 된다)<br/>
수열이 주어졌을 때, 총 몇 개의 수가 좋은 수 일까?<br/>


## 입력
첫째 줄에 수열 A의 크기 N이 주어진다. (1 ≤ N ≤ 5000) 둘째 줄에는 수열 A의 각 숫자가 공백으로 구분되어 주어진다. (-100,000 ≤ Ai ≤ 100,000)<br/>


## 출력
첫째 줄에 좋은 수의 개수를 출력한다.<br/>


## 예제 입력
6<br/>
1 2 3 5 7 10<br/>


## 예제 출력
4<br/>


## 풀이
i번째 수가 그 앞에 있는 수 세 개의 합으로 나타낼 수 있는지 확인하는 문제다.<br/>
즉, a[k]를 A의 k + 1번째 수라 하면, a[i] = a[p] + a[q] + a[r]인 i보다 작은 p, q, r이 존재하는지 확인하는 문제다.<br/>
여기서 중복 사용을 허용하므로 p = q, p = r 또는 q = r이어도 된다.<br/>


N의 범위가 5,000으로 세 수를 선택하며 확인하는 경우 즉, i보다 작은 p, q, r에 대해 a[p] + a[q] + a[r]의 경우를 모두 확인하는 방법이다.<br/>
N^3 의 방법 경우 최악의 경우 100억번 이상의 연산을 하므로 시간초과 난다.<br/>


그런데 a[i] = a[p] + a[q] + a[r]을 a[i] - a[p] = a[q] + a[r]로 볼 수 있다.<br/>
그리고 p < i를 조사하며 a[i] - a[p]의 값을 찾는 경우 i ≤ N의 시간이 걸린다.<br/>
그리고 a[q] + a[r]의 결과값을 해시에 저장하는 경우 존재하는지 확인하는 것은 O(1)에 확인 가능하다.<br/>


i보다 작은 q, r에 대해 a[q] + a[r]를 모두 찾는 경우는 i^2 ≤ N^2 시간이 걸린다.<br/>
각 k보다 작은 q, r의 모든 합을 저장한 집합 S(k)를 다음과 같이 정의하자.<br/>
S(k) = \{ a[q] + a[r] \| q < k, r < k }라 하자.<br/>
매번 S(k)를 찾는 경우 각 i에 대해 O(N^2)이 걸리므로 전체 시간복잡도는 O(N^3)이다.<br/>


그런데 S(k - 1) ⊆ S(k)임은 정의로부터 자명하다.<br/>
즉, S(k)는 S(k - 1)에 새로운 원소만 추가한 것이다.<br/>
따라서 S(k)를 직접 새로 구성하지 않고, 이전 S(k - 1)에 새롭게 등장하는 원소만 추가하여 각 i에 대해 O(N) 시간으로 S(i)를 갱신할 수 있다.<br/>
S(i - 1)를 알고 있다고 하자. S(i)에는 있고 S(i - 1)에 없는 원소들은 j < i 이고 a[i] + a[j]들임을 알 수 있다.<br/>
S(i) = S(i - 1) ∪ \{ a[j] + a[i - 1] \| j < i }가 성립한다.<br/>
그래서 각 j < i에 대해 S에 a[j] + a[i - 1]의 원소만 추가해주면서 S(i)를 찾았다.<br/>


그래서 각 i에 대해 i ≤ N의 연산으로 a[i] - a[p] = a[q] + a[r]이 되는 p가 있는지 확인할 수 있다.<br/>


해시는 포함 여부만 확인하기에 Dictionary<int, bool>로 확인해도 되고, HashSet<int>로 포함여부를 확인해도 된다.<br/>
여기서는 값의 범위가 -10만에서 10만으로 두 개의 수를 합쳐도 -20만에서 20만이다.<br/>
두 수의 합에 + 20만을 인덱스로 해서 bool 배열을 해시처럼 이용했다.<br/>


해시의 경우 키를 해싱하고 연결리스트 형식으로 원소가 존재하는지 찾아간다.<br/>
그래서 다음 노드를 확인하는 변수가 있어 배열보다 메모리를 더 사용하고, 하나의 노드씩 확인하므로 덧셈 한번에 끝나는 배열보다 시간이 더 걸린다.<br/>


이처럼 각 i에 대해 a[i] - a[p] = a[q] + a[r]인 p, q, r이 존재하는지를 O(N) 시간에 확인할 수 있고, 총 N개의 원소에 대해 이 작업을 반복하므로 전체 시간복잡도는 O(N^2)이다.<br/>
이는 제한 시간 안에 문제를 해결하기에 충분한 시간 복잡도다.<br/>


## 문제 링크
https://www.acmicpc.net/problem/5624