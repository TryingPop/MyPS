# C#

## 난이도 : 다이아몬드 4

## 알고리즘 분류
  - 자료 구조
  - 트리
  - 세그먼트 트리
  - 느리게 갱신되는 세그먼트 트리
  - 오일러 경로 테크닉
  - heavy-light 분할

## 제한조건
  - 시간 제한 : 3초
  - 메모리 제한 : 1024MB

## 문제
야구선수인 메시는 국제 메시 기구(IMO, International messi organization)의 금고 관리자이다. 트리를 사랑하는 메시는 금고를 금고 1이 루트인 트리 모양으로 연결해서 관리한다고 한다.<br/>
업무시간에 A+B를 풀고 있던 메시는 메일 하나를 받았는데, 그 메일에는 '메시 흑역사.jpg.exe'라는 이름의 첨부파일이 하나 있었다. 안 그래도 어제 도난 사건으로 금고 N개가 다 털려 0원밖에 남지 않아 해고당할 위기에 처했는데 흑역사까지 드러날 위기에 처한 메시는 한 치의 고민도 없이 첨부파일을 열었다. 그러자 이상한 콘솔 창이 등장했다!<br/>
금★고의 요☆정 지♨니! 금고 속의 돈을 늘려드립니다! 명령어를 입력하세요. 명령어의 목록은 다음과 같습니다.<br/>

  - "1 X V" 금고 X의 서브트리에 있는 모든 금고에 V원을 더합니다. (1 ≤ X ≤ N, 1 ≤ V ≤ 109)
  - "2 X Y V" 금고 X부터 금고 Y까지의 경로에 있는 모든 금고에 V원을 더합니다. 단, 경로는 경계를 포함합니다. (1 ≤ X, Y ≤ N, 1 ≤ V ≤ 109)
  - "3 X V" 금고 X의 서브트리에 있는 모든 금고의 돈을 V배 합니다. (1 ≤ X ≤ N, 0 ≤ V ≤ 109)
  - "4 X Y V" 금고 X부터 금고 Y까지의 경로에 있는 모든 금고의 돈을 V배 합니다. 단, 경로는 경계를 포함합니다. (1 ≤ X, Y ≤ N, 0 ≤ V ≤ 109)
  - "5 X" 금고 X의 서브트리에 있는 모든 금고의 돈을 합한 값을 출력합니다. (1 ≤ X ≤ N)
  - "6 X Y" 금고 X부터 금고 Y까지의 경로에 있는 모든 금고의 돈을 합한 값을 출력합니다. 단, 경로는 경계를 포함합니다. (1 ≤ X, Y ≤ N)

메시는 도난 사건을 없던 일로 만들 기회라고 생각하여 명령어를 입력했지만, 이 파일은 당연하게도 바이러스라서 메시가 3개월간 짜던 A+B의 코드를 다 날려버렸다. 화가 난 메시는 위의 명령어를 실행하는 프로그램을 직접 만들기로 했다.<br/>


## 입력
첫째 줄에 N, Q가 주어진다. (1 ≤ N ≤ 500,000, 1 ≤ Q ≤ 100,000)<br/>
다음 N-1줄 중 i번째 줄에는 Si, Ei가 주어지며, 이는 금고 Si와 금고 Ei가 연결되어 있다는 뜻이다. (1 ≤ Si, Ei ≤ N)<br/>
금고가 연결된 모양은 올바른 트리 모양이다.<br/>
다음 Q줄에는 명령어들이 한 줄에 하나씩 주어진다.<br/>


## 출력
출력 명령어가 주어질 때마다 값을 출력한다. 단, 메시의 컴퓨터는 최신 트렌드인 4294967296비트 컴퓨터와는 다르게 32비트 컴퓨터이므로 232로 나눈 나머지를 대신 출력한다.<br/>


## 예제 입력
5 10<br/>
2 4<br/>
4 3<br/>
5 4<br/>
2 1<br/>
3 1 82<br/>
6 3 5<br/>
2 2 5 45<br/>
2 3 2 70<br/>
6 3 5<br/>
5 3<br/>
4 2 1 47<br/>
1 1 95<br/>
6 3 2<br/>
4 5 1 38<br/>


## 예제 출력
0<br/>
230<br/>
70<br/>
5875<br/>


## 힌트
명령어가 실행될 때마다 각 금고에 있는 돈은 다음과 같다.<br/>

||0|1|2|3|4|5|6|7|8|9|10|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|금고 1|0|0|0|0|0|0|0|0|95|95|3610|
|금고 2|0|0|0|45|115|115|115|5405|5500|5500|209000|
|금고 3|0|0|0|0|0|70|70|70|70|165|165|165|
|금고 4|0|0|0|45|115|115|115|115|210|210|7980|
|금고 5|0|0|0|45|45|45|45|45|140|140|5320|


## 풀이
금고는 트리형태로 주어진다.<br/>
그리고 금고 X에서부터 Y경로에 있는 범위의 데이터를 다뤄야 한다.<br/>
이에 HLD 알고리즘을 써서 새로운 인덱스를 부여하고 인덱스를 관리한다.<br/>
그리고 데이터를 관리할 세그먼트 트리를 따로 만들었다.<br/>
이후 쿼리대로 명령을 시행해 풀었다.<br/>


## 문제 링크
https://www.acmicpc.net/problem/17429