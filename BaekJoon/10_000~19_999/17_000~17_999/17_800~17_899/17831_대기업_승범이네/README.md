# C#

## 난이도 : 플레티넘 5

## 알고리즘 분류
  - 다이나믹 프로그래밍
  - 트리
  - 트리에서의 다이나믹 프로그래밍

## 제한조건
  - 시간 제한 : 1초
  - 메모리 제한 : 512 MB

## 문제
㈜승범이네는 사장 승범이를 포함한 N명의 직원이 모두 판매원인 다단계 회사이다. 사장 승범이를 제외한 모든 판매원에게는 사수가 한 명씩 배정된다. 만약 판매원 A가 B의 사수라면, B를 A의 부사수라고 부른다.<br/>
작년에 창설된 ㈜승범이네는 큰 수익률을 기록하고 대기업으로 거듭났다. ㈜승범이네의 더 큰 성장을 위해 멘토링 제도를 도입하려고 한다. 승범이는 사수와 부사수 관계에 있는 두 판매원을 각각 서로의 멘토와 멘티로 만들 수 있으며, 이 경우 두 판매원이 멘토링 관계에 있다고 한다. 한 판매원은 최대 1개의 멘토링 관계에만 속할 수 있다. 즉, 한 판매원이 여러 명의 멘토가 되거나, 여러 명의 멘티가 되거나, 멘토인 동시에 멘티가 될 수는 없다. 물론 멘토링 관계에 속하지 않는 직원이 있을 수도 있다.<br/>
이렇게 만들어진 멘토링 관계에서는 시너지 효과가 발생한다. 승범이는 모든 판매원의 실력을 수치화시켰으며, 한 멘토링 관계에서 발생하는 시너지는 멘토와 멘티의 실력의 곱과 같다는 것을 발견했다. 승범이는 적절하게 멘토링 관계를 만들어, 모든 멘토링 관계에서 발생하는 시너지의 합을 최대로 만들려고 한다.<br/>
위 그림은 ㈜승범이네의 회사 구조와 멘토링 관계를 나타낸 예시이다. 각 원은 한 명의 판매원을 의미하며, 원 안에 쓰인 숫자는 그 판매원의 실력이다. 화살표는 사수-부사수 관계를 나타낸다. 이 경우 가능한 시너지의 최대 합은 5×7 + 4×3 + 3×3 + 4×5 + 3×1 = 79이다.<br/>


## 입력
첫 번째 줄에 판매원들의 수 N(2 ≤ N ≤ 200,000)이 주어진다. 판매원들은 1번, 2번, …, N번으로 번호가 매겨지며, 승범이는 항상 1번이다.<br/>
두 번째 줄에 2번 판매원부터 N번 판매원의 사수가 순서대로 공백으로 구분되어 주어진다. <br/>
세 번째 줄에 i번 판매원의 실력을 나타내는 정수 A1, A2, …, AN (0 ≤ Ai ≤ 100)이 순서대로 공백으로 구분되어 주어진다.<br/>


## 출력
첫 번째 줄에 모든 멘토링 관계에서 발생하는 시너지의 합의 최댓값을 출력한다. 만약 멘토링 관계가 하나도 성립될 수 없을 경우, 0을 출력한다.<br/>


## 예제 입력
12<br/>
1 1 1 2 2 6 7 3 4 10 4<br/>
5 7 3 4 4 2 4 3 3 3 1 5<br/>


## 예제 출력
79<br/>


## 풀이
선택되지 않은 부모에서 선택되지 않은 자식으로만 잇는다. 그러면, 3개이상 이어진 경우는 존재하지 않는다.<br/>
dp[i][j] = val를 j번 노드에 대해 i = 1이면 j 번 노드와 자식을 이은 경우고, i = 0이면 자식과 잇지 않은 경우를 나타낸다.<br/>
그리고 val는 각 경우에 대해 시너지 합의 최댓값이되게 dp를 선언한다.<br/>
그러면 dp[0][j]는 j의 자식들의 노드를 cj라하면 dp[0][j] = ∑max(dp[0][cj], dp[1][cj])가 된다.<br/>
dp[1][j]는 이은 자식이 cj라 하면, max(∑max(dp[0][ck], dp[1][ck]) + dp[0][cj] + arr[j] * arr[cj]) 이다. 여기서 ck는 j의 자식 중 cj가 아닌 모든 자식을 뜻한다.<br/>
그리고 arr[i]는 i번 노드의 값이 된다.<br/>
이를 dfs를 이용해 찾아 갔다.<br/>


## 문제 링크
https://www.acmicpc.net/problem/17831