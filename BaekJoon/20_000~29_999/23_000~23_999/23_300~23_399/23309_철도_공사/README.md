# C#

## 난이도 : 골드 4

## 알고리즘 분류
  - 구현
  - 자료 구조
  - 연결 리스트

## 제한조건
  - 시간 제한 : 2초
  - 메모리 제한 : 512 MB

## 문제
연세대학교가 위치한 신촌역이 속한 2호선은 그림과 같이 N개의 역이 원형으로 연결되어 있다. 각 역은 고유 번호가 할당돼 있으며 역들의 고유 번호는 서로 다르다. 그리고 특정 역의 다음 역은 시계 방향으로 인접한 역을 의미하고, 이전 역은 반시계 방향으로 인접한 역을 의미한다.
2호선은 지하철 노선들 중 유일한 흑자 노선이다. 때문에 2호선 공사 자금이 넉넉하기에 M번의 공사를 거치려고 한다. 각 공사는 다음 4가지 중 하나를 시행한다.<br/>

  - 고유 번호 i를 가진 역의 다음 역의 고유 번호를 출력하고, 그 사이에 고유 번호 j인 역을 설립한다.
  - 고유 번호 i를 가진 역의 이전 역의 고유 번호를 출력하고, 그 사이에 고유 번호 j인 역을 설립한다.
  - 고유 번호 i를 가진 역의 다음 역을 폐쇄하고 그 역의 고유 번호를 출력한다.
  - 고유 번호 i를 가진 역의 이전 역을 폐쇄하고 그 역의 고유 번호를 출력한다.

이 때, 이미 설립한 역은 다시 설립하지 않으며 폐쇄한 역은 다시 설립될 수 있다. 그리고 폐쇄 작업은 현재 설립된 역이 2개 이상일 때만 들어온다.<br/>
2호선을 공사하는 프로그램을 만들어보자.<br/>


## 입력
첫 번째 줄에 공사를 시작하기 이전에 있는 역의 개수를 나타내는 양의 정수 N과 공사 횟수를 나타내는 양의 정수 M이 주어진다. (1 ≤ N ≤ 500,000, 1 ≤ M ≤ 1,500,000)<br/>
두 번째 줄에는 공사를 시작하기 이전에 있는 역의 고유 번호를 시계 방향 순서대로 주어진다. 같은 고유 번호를 가진 역은 주어지지 않는다.<br/>
이후 M개의 줄에 걸쳐서 공사에 대한 정보를 다음과 같이 주어진다.<br/>

  - BN i j : 고유 번호 i를 가진 역의 다음 역의 고유 번호를 출력하고, 그 사이에 고유 번호 j인 역을 설립한다.
  - BP i j : 고유 번호 i를 가진 역의 이전 역의 고유 번호를 출력하고, 그 사이에 고유 번호 j인 역을 설립한다.
  - CN i : 고유 번호 i를 가진 역의 다음 역을 폐쇄하고 그 역의 고유 번호를 출력한다.
  - CP i : 고유 번호 i를 가진 역의 이전 역을 폐쇄하고 그 역의 고유 번호를 출력한다.

입력으로 들어오는 모든 역의 고유 번호는 1 이상 1,000,000 이하의 양의 정수다. 폐쇄 작업은 현재 설립된 역이 2개 이상일 때만 들어오며, 이미 설립된 역은 또 설립될 수 없지만 폐쇄된 역은 다시 설립될 수 있다.<br/>


## 출력
각 공사에 대한 출력 값을 M개의 줄에 걸쳐서 출력한다.<br/>


## 예제 입력
4 4<br/>
2 7 3 5<br/>
BN 5 11<br/>
BP 3 6<br/>
CP 2<br/>
CN 7<br/>


## 예제 출력
2<br/>
7<br/>
11<br/>
6<br/>


## 풀이
처음에 클래스로 연결리스트 노드를 정의해 문제를 푸니 시간초과가 났다.<br/>
매번 시작지점에서 목표 지점까지 나아갔기 때문이다.<br/>


역의 번호가 100만 이하로 100만 길이의 배열을 둘만하다고 생각했다.<br/>
그래서 bs[i] = val를 i번 역의 이전에 있는 역의 고유번호를 val로 선언하는 배열을 만들고,<br/>
ns[i] = val를 i 번 역의 다음에 있는 역의 고유번호를 val로 선언하는 배열을 선언해 풀었다.<br/>
인접한 역 A와 역 B 사이에 역 C를 삽입하는 경우 A의 다음을 C로 C의 이전을 A로, C의 다음을 B로, B의 이전을 C로 갱신하면 된다.<br/> 
순차적으로 인접한 세 역 A, B, C 에대해 B를 제거하는 경우 A의 다음역을 C로 C의 이전역을 A로 갱신하면 된다.<br/>
이렇게 진행하면 모든 쿼리를 O(1)에 해결할 수 있다.<br/>


지금와서 생각해보면 Dictionary로 해당 노드로 접근할 수 있게 했으면 시간초과 나지 않았을거 같다.<br/>


## 문제 링크
https://www.acmicpc.net/problem/23309