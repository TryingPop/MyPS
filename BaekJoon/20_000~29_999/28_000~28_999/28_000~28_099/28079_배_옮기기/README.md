# C#

## 난이도 : 플레티넘 5

## 알고리즘 분류
  - 다이나믹 프로그래밍
  - 그래프 이론
  - 비트마스킹
  - 최단 경로
  - 데이크스트라
  - 비트필드를 이용한 다이나믹 프로그래밍

## 제한조건
  - 시간 제한 : 1초
  - 메모리 제한 : 1024 MB

## 문제
치훈이는 배 N척을 강 건너편으로 옮기려고 한다. 강을 건너가거나 건너오기 위해서는 치훈이가 가지고 있는 배를 운전하여 건너야 한다.<br/>
배의 크기가 X라고 할 때, 치훈이가 그 배를 운전하여 강 건너편으로 옮기는 데에는 X분이 걸린다.<br/>
배를 운전하여 옮길 때, 크기가 더 작은 배를 최대 한 척까지 싣고 동시에 옮기는 것도 가능하다. 이 때 배를 옮기는 시간은 큰 배 하나를 옮기는 것과 같은 시간이 걸린다.<br/>
이 때, 치훈이가 배 N척을 모두 강 건너편으로 옮기는데 필요한 최소 시간을 계산하는 프로그램을 작성하시오.<br/>


## 입력
첫째 줄에 배의 개수 N이 주어진다.<br/>
둘째 줄에 i번째 배의 크기를 나타내는 B_i가 공백으로 구분되어 주어진다.<br/>


## 출력
치훈이가 모든 배를 강 건너편으로 옮기는데 필요한 최소 시간 (분)을 출력한다.<br/>
만약 어떤 방법을 써도 모든 배를 강 건너편으로 옮길 수 없다면 -1을 출력한다.<br/>


## 제한
  - 1 ≤ N ≤ 15
  - 1 ≤ B_i ≤ 100,000
  - B_i는 정수이다.


## 예제 입력
4<br/>
1 2 4 8<br/>


## 예제 출력
15<br/>


## 힌트
시작 위치에서 1, 2번 함께 옮기면 2초가 걸린다.<br/>
그리고 시작 위치로 1번으로 되돌아오면 1초가 걸린다.<br/>


다음 시작 위치에서 1, 4번 함께 옮기면 4초가 걸린다.<br/>
그리고 시작 위치로 1번으로 되돌아오면 1초가 걸린다.<br/>


다음 시작 위치에서 1, 8번 함께 옮기면 8초가 걸린다.<br/>
모든 배가 강 건너편으로 이동했고 총 걸린 시간은 15(= 2 + 1 + 4 + 1 + 8)이다.<br/>


## 요약

  - 목표: 배 N척이 시작 위치에 있고, 모두 도착 위치로 옮길 때 최소 시간

  - 정의:
    - dp1[state] = 도착 위치에 있는 배의 상태 state이고, 지훈이가 시작 위치에 있을 때 배를 모두 옮기는 최소 시간
    - dp2[state] = 도착 위치에 있는 배의 상태 state이고, 지훈이가 도착 위치에 있을 때 배를 모두 옮기는 최소 시간

  - 초기값:
    - dp1[state] = INF (정답이 될 수 없는 큰 값, 300만 이상)
    - 도착 위치에 배가 모두 있는 상태를 endState라 할 때, dp2[endState] = 0
    - state != endState에 대해 dp2[state] = INF

  - 점화식:
    - 시작 위치에 있는 서로 다른 두 배를 i, j라 하고 무게를 각각 arr[i], arr[j]
    - 도착 위치에 있는 배 k라 하고 무게를 arr[k]
    - dp1[state] = Min(dp2[state | (1 << i) | (1 << j)] + Max(arr[i], arr[j]))
    - dp2[state] = Min(dp1[state ^ (1 << k)] + arr[k])

  - 정답:
    - dp1[0]이 INF인 경우: -1
    - 이외 경우: dp1[0]

  - 시간 복잡도: O(2^N x N^2)


## 풀이
배 N척이 시작 위치에 있고, 모두 도착 위치로 옮겨야 한다.<br/>
지훈이는 배를 1척 또는 2척 옮길 수 있으며, 한 번 이동할 때 걸리는 시간은 옮기는 배 중 가장 무거운 배의 무게이다.<br/>
또한, 배를 모두 옮긴 후 지훈이는 강을 건너야 하지 않기 때문에, 마지막 지훈이의 위치는 도착 위치여야 한다.<br/>


배의 개수가 최대 15개이므로 초기 위치에 존재하는 배의 상태를 보면 2^15 = 32,768가지이다.<br/>
즉 도착한 배의 상태를 비트마스킹으로 표현할 수 있다.<br/>


배를 옮기는 시간은 자연수이므로 그리디로 배를 최소 시간으로 이동시키면서 모든 배를 옮길 때 전체 시간에서 최소임이 보장된다.<br/>
배를 옮기는 방식이 제한적이므로, 가능한 이동 조합을 모두 고려하면서 최소 시간을 구하는 DP 방식이 적절하다.<br/>


dp는 시작 위치 dp1와 도착 위치 dp2를 나타내는 2개를 이용해 풀었다.<br/>


dp1[state] = val를 다음과 같이 정의했다.<br/>

  - state: 도착 위치의 배 상태, i번 배가 있는 경우 i번째 비트 값이 1이고 없으면 0이다.
  - val: 지훈이가 시작 위치에 있을 때, state 상태에서 모든 배를 옮기는 최소 시간


dp2[state] = val를 다음과 같이 정의했다.<br/>

  - state: 도착 위치의 배 상태, i번 배가 있는 경우 i번째 비트 값이 1이고 없으면 0이다.
  - val: 지훈이가 도착 위치에 있을 때, state 상태에서 모든 배를 옮기는 최소 시간


다음과 같은 점화식을 얻을 수 있다.<br/>
dp1[state]는 state는 도착 위치에 있는 배의 상태이므로 비트 값이 0인 서로 무게가 다른 두 배 i, j라 하자.<br/>
지훈이가 시작 위치에서 i, j번 배를 도착 위치로 옮긴다고 보자.<br/>


i, j를 도착 위치로 옮기는 경우의 상태를 nextState라 하고, i, j의 배의 무게를 arr[i], arr[j]라 하자.<br/>
dp1[state] = Min(dp2[nextState] + Max(arr[i], arr[j]))를 얻는다.<br/>


마찬가지로 dp2[state]에 대해 state는 도착 위치에 있는 배의 상태이므로 비트 값이 1인 배 k라 하자.<br/>
지훈이가 도착 위치에서 k번 배를 시작 위치로 옮긴다고 보자.<br/>


k를 시작 위치로 옮기는 경우의 상태를 nextState라 하고, k 배의 무게를 arr[k]라 하자.<br/>
dp2[state] = Min(dp1[nextState] + arr[k])를 얻는다.<br/>


해당 방법으로 dp1, dp2를 설정하는 경우 dp2에 모든 배가 있는 경우 dp2의 값은 0이다.<br/>
이외 dp1, dp2의 값은 최소값을 찾아야 하므로 최솟값으로 될 수 없는 300만 이상의 값으로 채웠다.<br/>


배의 크기가 10만 이하이므로 지훈이가 시작 위치 → 도착 위치 → 시작 위치로 돌아오는 경우 20만을 넘지 않는다.<br/>
그래서 모두 옮길 수 있는 경우 배는 15개 이하이므로 최소시간은 15 x 20만 = 300만을 넘기지 않는다.<br/>


이렇게 정답을 찾는 경우 각 상태에 서로 다른 두 배를 찾는 경우 배의 개수를 N이라 하면 N^2번 연산을 한다.<br/>
그리고 각 상태는 배의 개수를 비트마스킹 한 것이므로 2^N번 즉, dp1, dp2의 크기를 넘지 않는다.<br/>
그래서 전체 시간 복잡도는 O((N^2 + N) x 2^N) = O(N^2 x 2^N)이다.<br/>


## 문제 링크
https://www.acmicpc.net/problem/28079